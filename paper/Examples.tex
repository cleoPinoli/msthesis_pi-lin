\subsection{Examples}
\label{sec:examples}

\begin{code}[hide]%
\>[0]\AgdaSymbol{\{-\#}\AgdaSpace{}%
\AgdaKeyword{OPTIONS}\AgdaSpace{}%
\AgdaPragma{--rewriting}\AgdaSpace{}%
\AgdaSymbol{\#-\}}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Function}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}\$\AgdaUnderscore{}}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Sum}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{inj‚ÇÅ}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{inj‚ÇÇ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Product}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}√ó\AgdaUnderscore{}}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{},\AgdaUnderscore{}}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{‚àÉ}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{‚àÉ-syntax}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{curry}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Fin}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{zero}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\#\AgdaUnderscore{}}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.List.Base}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}‚à∑\AgdaUnderscore{}}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[\AgdaUnderscore{}]}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Unary}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Type}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Context}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Permutations}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Process}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{DeadlockFreedom}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{deadlock-freedom}\AgdaSymbol{)}\<%
\end{code}

In this section we revisit and expand the processes discussed in
\Cref{ex:booleans,ex:echo} and show their encoding in our formalisation. The
encoding of $\Bool$ is straightforward

\begin{code}%
\>[0]\AgdaFunction{ùîπ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Type}\<%
\\
\>[0]\AgdaFunction{ùîπ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚äï}}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}\<%
\end{code}
and the boolean constants are encoded thus:
\begin{code}%
\>[0]\AgdaFunction{True}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaFunction{ùîπ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\AgdaFunction{True}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{select}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚ü®}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚ü©}}\AgdaSpace{}%
\AgdaInductiveConstructor{inj‚ÇÅ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{close}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{False}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaFunction{ùîπ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\AgdaFunction{False}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{select}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚ü®}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚ü©}}\AgdaSpace{}%
\AgdaInductiveConstructor{inj‚ÇÇ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{close}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSymbol{))}\<%
\end{code}

We take advantage of the host language for programming higher-order processes.
For example, we can define a conditional process thus:

\begin{code}%
\>[0]\AgdaOperator{\AgdaFunction{If\AgdaUnderscore{}Else}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{‚àÄ[}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚áí}}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚áí}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dual}\AgdaSpace{}%
\AgdaFunction{ùîπ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚à∑\AgdaUnderscore{}}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä¢}}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaFunction{]}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{If}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Else}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{case}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSymbol{)}%
\>[103I]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaInductiveConstructor{wait}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚ü®}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚ü©}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[103I]%
\>[35]\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{wait}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚ü®}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚ü©}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSymbol{))}\<%
\end{code}

A term $\AgdaFunction{If}~P~\AgdaFunction{Else}~Q$ is a process that waits for a
boolean value (\cf the $\AgdaFunction{dual}~\mathbb{B}$ type at the front of its
typing context) and continues as either $P$ or $Q$ depending on whether it
receives true or false. We use \AgdaFunction{curry‚àó} (defined in
\Cref{sec:context-agda}) to curry the constructor
\AgdaInductiveConstructor{case} so that we can supply its arguments one by one
saving a few parentheses and reducing clutter.

Next we define a process $\AgdaFunction{Drop}~P$ that consumes a boolean and
continues as $P$ regardless of its value.

\begin{code}%
\>[0]\AgdaFunction{Drop}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{‚àÄ[}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚áí}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dual}\AgdaSpace{}%
\AgdaFunction{ùîπ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚à∑\AgdaUnderscore{}}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä¢}}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaFunction{]}\<%
\\
\>[0]\AgdaFunction{Drop}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{If}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Else}}\AgdaSpace{}%
\AgdaBound{P}\<%
\end{code}

Using these higher-order forms, it is easy to define the usual boolean
connectives.

\begin{code}%
\>[0]\AgdaFunction{!!}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaFunction{ùîπ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaFunction{ùîπ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\AgdaFunction{!!}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{cut}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{If}}\AgdaSpace{}%
\AgdaFunction{False}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Else}}\AgdaSpace{}%
\AgdaFunction{True}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}\&\&\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}||\AgdaUnderscore{}}}%
\>[11]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaFunction{ùîπ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaFunction{ùîπ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaFunction{ùîπ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\&\&}}\AgdaSpace{}%
\AgdaBound{B}%
\>[9]\AgdaSymbol{=}%
\>[12]\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{cut}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\$}}\<%
\\
%
\>[12]\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{cut}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\$}}\<%
\\
%
\>[12]\AgdaOperator{\AgdaFunction{If}}\AgdaSpace{}%
\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{link}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Else}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Drop}\AgdaSpace{}%
\AgdaFunction{False}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{||}}\AgdaSpace{}%
\AgdaBound{B}%
\>[9]\AgdaSymbol{=}%
\>[12]\AgdaFunction{!!}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{!!}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\&\&}}\AgdaSpace{}%
\AgdaFunction{!!}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\<%
\end{code}

The function \AgdaFunction{\$} (defined in Agda's standard library) is just a
low-precedence, visible function application operator. We use it as a separator
to flatten deeply nested expressions and save a bunch of parentheses.
%
For the sake of illustration, we have chosen to define the disjunction
\AgdaFunction{||} from the conjunction \AgdaFunction{\&\&} and negation
\AgdaFunction{!!} using De Morgan's laws.

To test our definitions we implement a simple evaluator using the deadlock
freedom property. We have not proved a termination result, but since linear
logic enjoys cut elimination we can safely annotate the evaluator as
terminating.

\begin{code}%
\>[0]\AgdaSymbol{\{-\#}\AgdaSpace{}%
\AgdaKeyword{TERMINATING}\AgdaSpace{}%
\AgdaSymbol{\#-\}}\<%
\\
\>[0]\AgdaFunction{eval}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{‚àÄ[}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚áí}}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaFunction{]}\<%
\\
\>[0]\AgdaFunction{eval}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{deadlock-freedom}\AgdaSpace{}%
\AgdaBound{P}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{inj‚ÇÅ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Q}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}%
\>[24]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Q}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{inj‚ÇÇ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Q}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}%
\>[24]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{eval}\AgdaSpace{}%
\AgdaBound{Q}\<%
\end{code}

Now if we ask Agda to normalise the goal
$\AgdaFunction{eval}~(\AgdaFunction{False}~\AgdaFunction{||}~\AgdaFunction{False})$
we obtain
$\AgdaInductiveConstructor{select}~(\AgdaInductiveConstructor{ch~‚ü®~<~‚Ä¢~‚ü©~inj‚ÇÇ}~(\AgdaInductiveConstructor{close~ch}))$,
that is the definition of \AgdaFunction{False}, as expected.

For the encoding of the polymorphic echo server (\Cref{ex:echo}), we start by
encoding its type $\OfCourse(\forall\X.\dual\X \Par (X \Ten \One))$:

\begin{code}%
\>[0]\AgdaFunction{ServerT}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Type}\<%
\\
\>[0]\AgdaFunction{ServerT}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{`!}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{`‚àÄ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{rav}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{\#}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚Öã}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{var}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{\#}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚äó}}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}\AgdaSymbol{)))}\<%
\end{code}

The notation $\AgdaFunction{\#}~n$ (defined in Agda's standard library) creates
an element of \AgdaDatatype{Fin} from the natural number $n$. Here it is used to
create the de Bruijn index of the type variable $X$.
%
We now encode the server
\begin{code}%
\>[0]\AgdaFunction{Server}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaFunction{ServerT}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\AgdaFunction{Server}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[242I]\AgdaFunction{curry}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{server}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaInductiveConstructor{un-[]}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\$}}\<%
\\
\>[.][@{}l@{}]\<[242I]%
\>[9]\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{all}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\<%
\\
%
\>[9]\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{join}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\$}}\<%
\\
%
\>[9]\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{fork}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{link}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{>}}\AgdaSpace{}%
\AgdaInductiveConstructor{‚Ä¢}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\$}}\<%
\\
%
\>[9]\AgdaInductiveConstructor{close}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\<%
\end{code}
and the client that sends true to it
\begin{code}%
\>[0]\AgdaFunction{Client}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dual}\AgdaSpace{}%
\AgdaFunction{ServerT}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚à∑}}\AgdaSpace{}%
\AgdaFunction{ùîπ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚à∑}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{Client}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[287I]\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{client}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\$}}\<%
\\
\>[.][@{}l@{}]\<[287I]%
\>[9]\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ex}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaFunction{ùîπ}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\$}}\<%
\\
%
\>[9]\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{fork}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaFunction{True}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\$}}\<%
\\
%
\>[9]\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{join}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\$}}\<%
\\
%
\>[9]\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{wait}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaFunction{‚â´}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\$}}\<%
\\
%
\>[9]\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{link}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{>}}\AgdaSpace{}%
\AgdaInductiveConstructor{‚Ä¢}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{ch}\<%
\end{code}

To test our definitions we compose client and server in parallel
\begin{code}%
\>[0]\AgdaFunction{Main}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Proc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaFunction{ùîπ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\AgdaFunction{Main}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{curry‚àó}\AgdaSpace{}%
\AgdaInductiveConstructor{cut}\AgdaSpace{}%
\AgdaFunction{Client}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{<}}\AgdaSpace{}%
\AgdaInductiveConstructor{‚Ä¢}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{Server}\<%
\end{code}
and then ask Agda to normalize \AgdaFunction{Main}, which yields
\AgdaFunction{True} as expected.

\begin{remark}
    Writing processes in Agda would be more pleasant if the constructors of the
    data type \AgdaDatatype{Proc} were naturally curried, instead of currying
    them on demand with \AgdaFunction{curry‚àó} as we do here.
    %
    Below is the naturally curried constructor \AgdaInductiveConstructor{fork}
    of a hypothetical data type \AgdaDatatype{Proc'}, obtained by expanding the
    definition of separating conjunction:
\begin{code}[hide]%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Proc'}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Context}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[2]\AgdaInductiveConstructor{fork}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[343I]\AgdaSymbol{‚àÄ\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaBound{Œî}\AgdaSpace{}%
\AgdaBound{Œò}\AgdaSpace{}%
\AgdaBound{Œò‚ÇÅ}\AgdaSpace{}%
\AgdaBound{Œò‚ÇÇ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚äó}}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{Œî}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âÉ}}\AgdaSpace{}%
\AgdaBound{Œî}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{+}}\AgdaSpace{}%
\AgdaBound{Œò}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\<%
\\
\>[.][@{}l@{}]\<[343I]%
\>[9]\AgdaDatatype{Proc'}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚à∑}}\AgdaSpace{}%
\AgdaBound{Œò‚ÇÅ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{Œò}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âÉ}}\AgdaSpace{}%
\AgdaBound{Œò‚ÇÅ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{+}}\AgdaSpace{}%
\AgdaBound{Œò‚ÇÇ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Proc'}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{B}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚à∑}}\AgdaSpace{}%
\AgdaBound{Œò‚ÇÇ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Proc'}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚äó}}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚à∑}}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSymbol{)}\<%
\end{code}

    This version of \AgdaInductiveConstructor{fork} is fully curried, but also
    less readable than the one we gave in \Cref{sec:process-agda} because of the
    (now visible) context splittings. We can recover some clarity and still
    obtain a curried version of \AgdaInductiveConstructor{fork} using
    (literally) the magic wand:
\begin{code}[hide]%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Proc''}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Context}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[2]\AgdaInductiveConstructor{fork}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[391I]\AgdaSymbol{‚àÄ\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\<%
\\
\>[.][@{}l@{}]\<[391I]%
\>[9]\AgdaFunction{‚àÄ[}\AgdaSpace{}%
\AgdaDatatype{Ch}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚äó}}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚áí}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚à∑\AgdaUnderscore{}}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä¢}}\AgdaSpace{}%
\AgdaDatatype{Proc''}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚îÄ‚àó}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{B}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚à∑\AgdaUnderscore{}}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä¢}}\AgdaSpace{}%
\AgdaDatatype{Proc''}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚îÄ‚àó}}\AgdaSpace{}%
\AgdaDatatype{Proc''}\AgdaSpace{}%
\AgdaFunction{]}\<%
\end{code}

    However, the first arrow must be a plain implication \AgdaFunction{‚áí} and
    not a magic wand to account for the appropriate amount of context
    splittings. We found this formulation of the constructors harder to explain
    and motivate in \Cref{sec:process-agda}.
    %
    Since none of the alternative definitions of \AgdaDatatype{Proc} was fully
    satisfactory, we preferred the most elegant version of the data type at the
    expense of additional clutter in this section.
    %
    \eoe
\end{remark}
